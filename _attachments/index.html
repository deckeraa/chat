<!DOCTYPE html>
 
<! --
A very basic example in Javascript of how to attach a file to a CouchDB document. This will work wether or not the Document ID you define exists.
Log in at /_utils, upload this file to a document, and then view it for your own uploader. See the code for comments. ajaxSubmit() is the magic that attaches
as long as the Couch Doc exists because you can't submit a new Couch Document with an attachment.
by @rjsteinert http://rjsteinert.com
-->
 
<!-- <html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
<script src="/_utils/script/json2.js"></script>
<script src="/_utils/script/jquery.js?1.2.6"></script>
<script src="/_utils/script/jquery.couch.js?0.8.0"></script>
<script src="/_utils/script/jquery.form.js?0.9.0"></script>
<script type="text/javascript">
 $(function() {
   $('form.documentForm').submit(function(e) {
     // Prevent submit because we will use ajaxSubmit() to actually send the
     // attachment to CouchDB.
     e.preventDefault();
     // Get the user supplied details
     var input_db = "chat";//$('.documentForm input#_db').val();
     var input_id = $('.documentForm input#_id').val();
     var input_rev = $('.documentForm input#_rev').val();
       // Start by trying to open a Couch Doc at the _id and _db specified
     $.couch.db(input_db).openDoc(input_id, {
         // If found, then set the revision in the form and save
         success: function(couchDoc) {
           // Defining a revision on saving over a Couch Doc that exists is required.
           // This puts the last revision of the Couch Doc into the input#rev field
           // so that it will be submitted using ajaxSubmit.
           $('.documentForm input#_rev').val(couchDoc._rev);
           // Submit the form with the attachment
           $('form.documentForm').ajaxSubmit({
             url: "/"+ input_db +"/"+ input_id,
             success: function(response) {
               alert("Your attachment was submitted.")
             }
           })
         }, // End success, we have a Doc
         // If there is no CouchDB document with that ID then we'll need to create it before we can attach a file to it.
         error: function(status) {
           $.couch.db(input_db).saveDoc({"_id":input_id}, {
             success: function(couchDoc) {
               // Now that the Couch Doc exists, we can submit the attachment,
               // but before submitting we have to define the revision of the Couch
               // Doc so that it gets passed along in the form submit.
               $('.documentForm input#_rev').val(couchDoc.rev);
               $('form.documentForm').ajaxSubmit({
                 // Submit the form with the attachment
                 url: "/"+ input_db +"/"+ input_id,
                 success: function(response) {
                   alert("Your attachment was submitted.")
                 }
               });
             }
           })
         } // End error, no Doc
       }) // End openDoc()
   }) /* End form.documentForm submit */
 }) /* End jQuery ready */
</script>
</head>
<body>
<form class="documentForm" method="post" action="" enctype="multipart/form-data">
<input type="text" name="_id" id="_id" placeholder="Document ID" value="woof"/>
<input type="text" name="_rev" id="_rev" placeholder="Revision ID (always overridden in code)" style="display:none"/>
<input type="file" name="_attachments" id="_attachments" multiple="multiple" />
<input type="submit" class="Submit" value="Submit" />
</form>
</body>
</html> -->

<!DOCTYPE html>
<html>
  <head>
    <title>Example CouchApp</title>
    <link rel="stylesheet" href="style/main.css" type="text/css">
  </head>
  <body>
    <div id="account"></div>

    <h1>Example CouchApp</h1>

p    <div id="profile">
    </div>
    <div id="content"></div>

    <div id="sidebar">
      <p>Edit welcome message.</p>
      <p>Ideas: You could easily turn this into a photo sharing app, 
          or a grocery list, or a chat room. <a href="https://github.com/couchapp/example">Code for this app is on Github.</a></p>
    </div>
  </body>
  <script src="/_utils/script/sha1.js"></script>
  <script src="/_utils/script/json2.js"></script>
  <script src="/_utils/script/jquery.js"></script>
  <script src="/_utils/script/jquery.couch.js"></script>
  <script src="/_utils/script/jquery.form.js?0.9.0"></script>
  <script src="vendor/couchapp/jquery.couchLogin.js"></script>
  <script src="vendor/couchapp/jquery.couchProfile.js"></script>
  <script src="vendor/couchapp/md5.js"></script>
  <script src="vendor/couchapp/jquery.mustache.js"></script>

  <script id="new-message" type="text/x-mustache" charset="utf-8">
      <div class="avatar">
        {{#gravatar_url}}<img src="{{gravatar_url}}"/>{{/gravatar_url}}
        <div class="name">
          {{name}}
        </div>
      </div>
   <form id="create-message" method="post" action="" enctype="multipart/form-data">
     <input type="text" name="_id" id="_id" placeholder="Document ID" value="woof"/>
     <input type="text" name="_rev" id="_rev" placeholder="Revision ID (always overridden in code)" style="display:none"/>
     <input type="file" name="_attachments" id="_attachments" multiple="multiple" />
     <label>New message from {{nickname}}: <input type="text" name="message" size=60 value=""></label>
      <input type="submit" />
   </form>
      <div style="clear:left;"></div>
  </script>

  <script id="recent-messages" type="text/x-mustache" charset="utf-8">
        <h3>Recent Messages</h3>
        <ul id="items">
          {{#items}}
            <li>
              <div class="avatar">
                {{#gravatar_url}}<img src="{{gravatar_url}}" alt="{{name}}"/>{{/gravatar_url}}
                <div class="name">
                  {{nickname}}
                </div>
              </div>
              <p>{{message}}</p>
              <div style="clear:left;"></div>
            </li>
          {{/items}}
        </ul>
        <p><em>Protip:</em> If you setup continuous replication between this database and a remote one, this list will reflect remote changes in near real-time.</p>
        <p>This would be a good place to add pagination.</p>
  </script>
  <script src="script/app.js"></script>

</html>
